{"ast":null,"code":"import axios from \"axios\";\n\n// ==== Action Creators ====\n\nexport const saveUserCart = () => async (dispatch, getState) => {\n  const {\n    cart: {\n      cartItems\n    },\n    userLogin: {\n      userInfo\n    }\n  } = getState();\n  console.log(\"🛒 saveUserCart triggered\", {\n    userInfo,\n    cartItems\n  });\n\n  // ✅ Abort if user is not logged in or login failed\n  if (!userInfo || userInfo.success === false) {\n    console.warn(\"🚫 Aborting saveUserCart: user not logged in or login failed.\");\n    return;\n  }\n  try {\n    // Transform cart items to match the backend structure\n    const transformedCart = cartItems.filter(item => item._id && typeof item.qty === 'number').map(item => ({\n      productId: item._id,\n      qty: item.qty <= 0 ? 1 : item.qty\n    }));\n\n    // Validate that no item has an invalid quantity (<= 0)\n    if (transformedCart.some(item => !item.productId || item.qty <= 0)) {\n      console.error('❌ Invalid cart items:', transformedCart);\n      return;\n    }\n\n    // Send the transformed cart data to the backend\n    await axios.post(\"http://localhost:7000/api/cart/save\", {\n      cartItems: transformedCart\n    }, {\n      headers: {\n        Authorization: `Bearer ${userInfo.token}`\n      }\n    });\n    console.log(\"✅ Cart saved:\", transformedCart);\n  } catch (error) {\n    console.error(\"❌ Error saving cart to backend:\", error);\n  }\n};\n\n// Load the user's cart from the backend\n\nexport const loadUserCart = userInfo => async dispatch => {\n  try {\n    const {\n      data\n    } = await axios.get(\"http://localhost:7000/api/cart\", {\n      headers: {\n        Authorization: `Bearer ${userInfo.token}`\n      }\n    });\n    console.log(\"🛒 Loaded cart from DB:\", data);\n    dispatch({\n      type: \"LOAD_CART_FROM_DB\",\n      payload: data.cartItems || []\n    });\n  } catch (error) {\n    console.error(\"❌ Failed to load user cart:\", error);\n  }\n};\n\n// ==== Cart Manipulation Actions ====\n\nexport const addToCart = item => async dispatch => {\n  dispatch({\n    type: 'ADD_TO_CART',\n    payload: item\n  });\n  dispatch(saveUserCart());\n};\nexport const removeFromCart = item => async dispatch => {\n  dispatch({\n    type: 'REMOVE_FROM_CART',\n    payload: item\n  });\n  dispatch(saveUserCart());\n};\nexport const incrementCartCounter = id => async dispatch => {\n  dispatch({\n    type: 'INCREMENT_CART_COUNTER',\n    payload: id\n  });\n  dispatch(saveUserCart());\n};\nexport const decrementCartCounter = id => async dispatch => {\n  dispatch({\n    type: 'DECREMENT_CART_COUNTER',\n    payload: id\n  });\n  dispatch(saveUserCart());\n};\nexport const clearCart = () => async (dispatch, getState) => {\n  const {\n    userLogin: {\n      userInfo\n    }\n  } = getState();\n  if (userInfo) {\n    try {\n      await axios.post(\"/api/cart/clear\", {}, {\n        headers: {\n          Authorization: `Bearer ${userInfo.token}`\n        }\n      });\n    } catch (error) {\n      console.error(\"Error clearing cart in the backend:\", error);\n    }\n  }\n  dispatch({\n    type: 'CLEAR_CART'\n  });\n};","map":{"version":3,"names":["axios","saveUserCart","dispatch","getState","cart","cartItems","userLogin","userInfo","console","log","success","warn","transformedCart","filter","item","_id","qty","map","productId","some","error","post","headers","Authorization","token","loadUserCart","data","get","type","payload","addToCart","removeFromCart","incrementCartCounter","id","decrementCartCounter","clearCart"],"sources":["D:/Sachin/Project/E-Commerce Project/frontend/src/actions/cartActions.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\n// ==== Action Creators ====\r\n\r\nexport const saveUserCart = () => async (dispatch, getState) => {\r\n  const {\r\n    cart: { cartItems },\r\n    userLogin: { userInfo }\r\n  } = getState();\r\n\r\n  console.log(\"🛒 saveUserCart triggered\", { userInfo, cartItems });\r\n\r\n  // ✅ Abort if user is not logged in or login failed\r\n  if (!userInfo || userInfo.success === false) {\r\n    console.warn(\"🚫 Aborting saveUserCart: user not logged in or login failed.\");\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Transform cart items to match the backend structure\r\n    const transformedCart = cartItems\r\n      .filter(item => item._id && typeof item.qty === 'number')\r\n      .map(item => ({\r\n        productId: item._id,\r\n        qty: item.qty <= 0 ? 1 : item.qty,\r\n      }));\r\n\r\n\r\n    // Validate that no item has an invalid quantity (<= 0)\r\n    if (transformedCart.some(item => !item.productId || item.qty <= 0)) {\r\n      console.error('❌ Invalid cart items:', transformedCart);\r\n      return;\r\n    }\r\n\r\n    // Send the transformed cart data to the backend\r\n    await axios.post(\r\n      \"http://localhost:7000/api/cart/save\",\r\n      { cartItems: transformedCart },\r\n      {\r\n        headers: { Authorization: `Bearer ${userInfo.token}` },\r\n      }\r\n    );\r\n\r\n    console.log(\"✅ Cart saved:\", transformedCart);\r\n  } catch (error) {\r\n    console.error(\"❌ Error saving cart to backend:\", error);\r\n  }\r\n};\r\n\r\n// Load the user's cart from the backend\r\n\r\nexport const loadUserCart = (userInfo) => async (dispatch) => {\r\n  try {\r\n    const { data } = await axios.get(\"http://localhost:7000/api/cart\", {\r\n      headers: {\r\n        Authorization: `Bearer ${userInfo.token}`,\r\n      },\r\n    });\r\n\r\n\r\n    console.log(\"🛒 Loaded cart from DB:\", data);\r\n\r\n    dispatch({ type: \"LOAD_CART_FROM_DB\", payload: data.cartItems || [] });\r\n  } catch (error) {\r\n    console.error(\"❌ Failed to load user cart:\", error);\r\n  }\r\n};\r\n\r\n// ==== Cart Manipulation Actions ====\r\n\r\nexport const addToCart = (item) => async (dispatch) => {\r\n  dispatch({ type: 'ADD_TO_CART', payload: item });\r\n  dispatch(saveUserCart());\r\n};\r\n\r\nexport const removeFromCart = (item) => async (dispatch) => {\r\n  dispatch({ type: 'REMOVE_FROM_CART', payload: item });\r\n  dispatch(saveUserCart());\r\n};\r\n\r\nexport const incrementCartCounter = (id) => async (dispatch) => {\r\n  dispatch({ type: 'INCREMENT_CART_COUNTER', payload: id });\r\n  dispatch(saveUserCart());\r\n};\r\n\r\nexport const decrementCartCounter = (id) => async (dispatch) => {\r\n  dispatch({ type: 'DECREMENT_CART_COUNTER', payload: id });\r\n  dispatch(saveUserCart());\r\n};\r\n\r\nexport const clearCart = () => async (dispatch, getState) => {\r\n  const { userLogin: { userInfo } } = getState();\r\n\r\n  if (userInfo) {\r\n    try {\r\n      await axios.post(\"/api/cart/clear\", {}, {\r\n        headers: { Authorization: `Bearer ${userInfo.token}` },\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error clearing cart in the backend:\", error);\r\n    }\r\n  }\r\n\r\n  dispatch({ type: 'CLEAR_CART' });\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}