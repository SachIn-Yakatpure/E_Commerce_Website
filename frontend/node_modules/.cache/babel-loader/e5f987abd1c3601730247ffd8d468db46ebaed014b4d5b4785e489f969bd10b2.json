{"ast":null,"code":"const savedCartState = JSON.parse(localStorage.getItem('cartState'));\nconst initialState = savedCartState || {\n  cartItems: [],\n  cartCounter: 0,\n  totalPrice: 0,\n  taxes: 0,\n  deliverCharges: 50,\n  grandTotal: 0\n};\n\n// Function to calculate total price, taxes, and grand total\nconst calculateTotals = (cartItems, deliverCharges) => {\n  const totalPrice = cartItems.reduce((acc, item) => acc + item.total_item_price, 0);\n  const taxes = totalPrice * 0.18;\n  const grandTotal = totalPrice + taxes + deliverCharges;\n  return {\n    totalPrice,\n    taxes,\n    grandTotal\n  };\n};\nconst cartReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'ADD_TO_CART':\n      {\n        const productId = action.payload.productId || action.payload._id || action.payload.id;\n        if (!productId) {\n          console.warn('Missing product ID in payload:', action.payload);\n        }\n        const existIndex = state.cartItems.findIndex(item => item.id === productId || item.productId === productId || item._id === productId);\n        let updatedState;\n        if (existIndex !== -1) {\n          // If item already exists, update its quantity\n          const updatedCartItems = state.cartItems.map((item, index) => {\n            if (index === existIndex) {\n              let newQty = item.qty + 1;\n              if (newQty > item.countInStock) {\n                newQty = item.countInStock;\n              }\n              return {\n                ...item,\n                qty: newQty,\n                total_item_price: newQty * item.price\n              };\n            }\n            return item;\n          });\n          updatedState = {\n            ...state,\n            cartItems: updatedCartItems,\n            cartCounter: state.cartCounter + 1\n          };\n        } else {\n          // Add new item to cart\n          updatedState = {\n            ...state,\n            cartItems: [...state.cartItems, {\n              ...action.payload,\n              id: productId,\n              qty: 1,\n              total_item_price: action.payload.price\n            }],\n            cartCounter: state.cartCounter + 1\n          };\n        }\n        const {\n          totalPrice,\n          taxes,\n          grandTotal\n        } = calculateTotals(updatedState.cartItems, state.deliverCharges);\n        updatedState = {\n          ...updatedState,\n          totalPrice,\n          taxes,\n          grandTotal\n        };\n        localStorage.setItem('cartState', JSON.stringify(updatedState));\n        return updatedState;\n      }\n    case 'INCREMENT_CART_COUNTER':\n      {\n        const updatedCartItems = state.cartItems.map(item => {\n          if (item.id === action.payload) {\n            const newQty = item.qty + 1;\n            return {\n              ...item,\n              qty: newQty,\n              total_item_price: newQty * item.price\n            };\n          }\n          return item;\n        });\n        const {\n          totalPrice,\n          taxes,\n          grandTotal\n        } = calculateTotals(updatedCartItems, state.deliverCharges);\n        const updatedState = {\n          ...state,\n          cartItems: updatedCartItems,\n          totalPrice,\n          taxes,\n          grandTotal\n        };\n        localStorage.setItem('cartState', JSON.stringify(updatedState));\n        return updatedState;\n      }\n    case 'DECREMENT_CART_COUNTER':\n      {\n        const updatedCartItems = state.cartItems.map(item => {\n          if (item.id === action.payload && item.qty > 1) {\n            const newQty = item.qty - 1;\n            return {\n              ...item,\n              qty: newQty,\n              total_item_price: newQty * item.price\n            };\n          }\n          return item;\n        });\n        const {\n          totalPrice,\n          taxes,\n          grandTotal\n        } = calculateTotals(updatedCartItems, state.deliverCharges);\n        const updatedState = {\n          ...state,\n          cartItems: updatedCartItems,\n          totalPrice,\n          taxes,\n          grandTotal\n        };\n        localStorage.setItem('cartState', JSON.stringify(updatedState));\n        return updatedState;\n      }\n    case 'LOAD_CART_FROM_DB':\n      {\n        const cartItems = action.payload; // Loaded from the backend or localStorage\n        const {\n          totalPrice,\n          taxes,\n          grandTotal\n        } = calculateTotals(cartItems, state.deliverCharges);\n        const cartCounter = cartItems.reduce((acc, item) => acc + item.qty, 0);\n        const updatedState = {\n          ...state,\n          cartItems,\n          cartCounter,\n          totalPrice,\n          taxes,\n          grandTotal\n        };\n        localStorage.setItem('cartState', JSON.stringify(updatedState)); // Store the loaded state in localStorage\n        return updatedState;\n      }\n    case 'REMOVE_FROM_CART':\n      {\n        const updatedCartItems = state.cartItems.filter(item => item.id !== action.payload);\n        const totalQty = updatedCartItems.reduce((sum, item) => sum + item.qty, 0);\n        const totalPrice = updatedCartItems.reduce((sum, item) => sum + item.qty * item.price, 0);\n        const deliveryCharges = totalPrice > 0 ? 40 : 0;\n        const taxes = +(totalPrice * 0.18).toFixed(2);\n        const grandTotal = totalPrice + deliveryCharges + taxes;\n        return {\n          ...state,\n          cartItems: updatedCartItems,\n          cartCounter: totalQty,\n          totalPrice,\n          deliverCharges: deliveryCharges,\n          taxes,\n          grandTotal\n        };\n      }\n    case 'CLEAR_CART':\n      {\n        // Clear localStorage when cart is cleared\n        localStorage.removeItem('cartItems');\n        return {\n          ...state,\n          cartItems: [],\n          cartCounter: 0,\n          totalPrice: 0,\n          taxes: 0,\n          deliverCharges: 50,\n          grandTotal: 0\n        };\n      }\n    default:\n      return state;\n  }\n};\nexport default cartReducer;","map":{"version":3,"names":["savedCartState","JSON","parse","localStorage","getItem","initialState","cartItems","cartCounter","totalPrice","taxes","deliverCharges","grandTotal","calculateTotals","reduce","acc","item","total_item_price","cartReducer","state","action","type","productId","payload","_id","id","console","warn","existIndex","findIndex","updatedState","updatedCartItems","map","index","newQty","qty","countInStock","price","setItem","stringify","filter","totalQty","sum","deliveryCharges","toFixed","removeItem"],"sources":["D:/Sachin/Project/E-Commerce Project/frontend/src/reducers/cartReducer.js"],"sourcesContent":["const savedCartState = JSON.parse(localStorage.getItem('cartState'));\r\n\r\nconst initialState = savedCartState || {\r\n  cartItems: [],\r\n  cartCounter: 0,\r\n  totalPrice: 0,\r\n  taxes: 0,\r\n  deliverCharges: 50,\r\n  grandTotal: 0,\r\n};\r\n\r\n// Function to calculate total price, taxes, and grand total\r\nconst calculateTotals = (cartItems, deliverCharges) => {\r\n  const totalPrice = cartItems.reduce((acc, item) => acc + item.total_item_price, 0);\r\n  const taxes = totalPrice * 0.18;\r\n  const grandTotal = totalPrice + taxes + deliverCharges;\r\n\r\n  return { totalPrice, taxes, grandTotal };\r\n};\r\n\r\nconst cartReducer = (state = initialState, action) => {\r\n  switch (action.type) {\r\n\r\n    case 'ADD_TO_CART': {\r\n      const productId = action.payload.productId || action.payload._id || action.payload.id;\r\n\r\n      if (!productId) {\r\n        console.warn('Missing product ID in payload:', action.payload);\r\n      }\r\n\r\n      const existIndex = state.cartItems.findIndex(item => item.id === productId || item.productId === productId || item._id === productId);\r\n\r\n      let updatedState;\r\n\r\n      if (existIndex !== -1) {\r\n        // If item already exists, update its quantity\r\n        const updatedCartItems = state.cartItems.map((item, index) => {\r\n          if (index === existIndex) {\r\n            let newQty = item.qty + 1;\r\n            if (newQty > item.countInStock) {\r\n              newQty = item.countInStock;\r\n            }\r\n            return {\r\n              ...item,\r\n              qty: newQty,\r\n              total_item_price: newQty * item.price,\r\n            };\r\n\r\n          }\r\n          return item;\r\n        });\r\n\r\n        updatedState = {\r\n          ...state,\r\n          cartItems: updatedCartItems,\r\n          cartCounter: state.cartCounter + 1,\r\n        };\r\n      } else {\r\n        // Add new item to cart\r\n        updatedState = {\r\n          ...state,\r\n          cartItems: [\r\n            ...state.cartItems,\r\n            {\r\n              ...action.payload,\r\n              id: productId,\r\n              qty: 1,\r\n              total_item_price: action.payload.price,\r\n            },\r\n          ],\r\n          cartCounter: state.cartCounter + 1,\r\n        };\r\n      }\r\n\r\n      const { totalPrice, taxes, grandTotal } = calculateTotals(updatedState.cartItems, state.deliverCharges);\r\n\r\n      updatedState = {\r\n        ...updatedState,\r\n        totalPrice,\r\n        taxes,\r\n        grandTotal,\r\n      };\r\n\r\n      localStorage.setItem('cartState', JSON.stringify(updatedState));\r\n      return updatedState;\r\n    }\r\n\r\n\r\n    case 'INCREMENT_CART_COUNTER': {\r\n      const updatedCartItems = state.cartItems.map(item => {\r\n        if (item.id === action.payload) {\r\n          const newQty = item.qty + 1;\r\n          return {\r\n            ...item,\r\n            qty: newQty,\r\n            total_item_price: newQty * item.price,\r\n          };\r\n        }\r\n        return item;\r\n      });\r\n\r\n      const { totalPrice, taxes, grandTotal } = calculateTotals(updatedCartItems, state.deliverCharges);\r\n\r\n      const updatedState = {\r\n        ...state,\r\n        cartItems: updatedCartItems,\r\n        totalPrice,\r\n        taxes,\r\n        grandTotal,\r\n      };\r\n\r\n      localStorage.setItem('cartState', JSON.stringify(updatedState));\r\n      return updatedState;\r\n    }\r\n\r\n    case 'DECREMENT_CART_COUNTER': {\r\n      const updatedCartItems = state.cartItems.map(item => {\r\n        if (item.id === action.payload && item.qty > 1) {\r\n          const newQty = item.qty - 1;\r\n          return {\r\n            ...item,\r\n            qty: newQty,\r\n            total_item_price: newQty * item.price,\r\n          };\r\n        }\r\n        return item;\r\n      });\r\n\r\n      const { totalPrice, taxes, grandTotal } = calculateTotals(updatedCartItems, state.deliverCharges);\r\n\r\n      const updatedState = {\r\n        ...state,\r\n        cartItems: updatedCartItems,\r\n        totalPrice,\r\n        taxes,\r\n        grandTotal,\r\n      };\r\n\r\n      localStorage.setItem('cartState', JSON.stringify(updatedState));\r\n      return updatedState;\r\n    }\r\n\r\n    case 'LOAD_CART_FROM_DB': {\r\n      const cartItems = action.payload;  // Loaded from the backend or localStorage\r\n      const { totalPrice, taxes, grandTotal } = calculateTotals(cartItems, state.deliverCharges);\r\n      const cartCounter = cartItems.reduce((acc, item) => acc + item.qty, 0);\r\n\r\n      const updatedState = {\r\n        ...state,\r\n        cartItems,\r\n        cartCounter,\r\n        totalPrice,\r\n        taxes,\r\n        grandTotal,\r\n      };\r\n\r\n      localStorage.setItem('cartState', JSON.stringify(updatedState));  // Store the loaded state in localStorage\r\n      return updatedState;\r\n    }\r\n\r\n\r\n    case 'REMOVE_FROM_CART': {\r\n      const updatedCartItems = state.cartItems.filter(item => item.id !== action.payload);\r\n\r\n      const totalQty = updatedCartItems.reduce((sum, item) => sum + item.qty, 0);\r\n      const totalPrice = updatedCartItems.reduce((sum, item) => sum + item.qty * item.price, 0);\r\n      const deliveryCharges = totalPrice > 0 ? 40 : 0;\r\n      const taxes = +(totalPrice * 0.18).toFixed(2);\r\n      const grandTotal = totalPrice + deliveryCharges + taxes;\r\n\r\n      return {\r\n        ...state,\r\n        cartItems: updatedCartItems,\r\n        cartCounter: totalQty,\r\n        totalPrice,\r\n        deliverCharges: deliveryCharges,\r\n        taxes,\r\n        grandTotal\r\n      };\r\n    }\r\n\r\n    case 'CLEAR_CART': {\r\n      // Clear localStorage when cart is cleared\r\n      localStorage.removeItem('cartItems');\r\n      return {\r\n        ...state,\r\n        cartItems: [],\r\n        cartCounter: 0,\r\n        totalPrice: 0,\r\n        taxes: 0,\r\n        deliverCharges: 50,\r\n        grandTotal: 0,\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default cartReducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}